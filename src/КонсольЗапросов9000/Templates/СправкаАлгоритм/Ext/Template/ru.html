<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html><head><meta content="text/html;charset=utf-8" http-equiv="content-type"></meta><link rel="stylesheet" type="text/css" href="__STYLE__"></link><meta name="GENERATOR" content="MSHTML 11.00.10570.1001"></meta></head><body>
<h2>Обработка результата запроса кодом</h2>
<div><font size="4">Выполнение кода возможно в пяти режимах.</font></div>
<h2>Простое выполнение</h2>
<p><font size="4">Код просто выполняется на сервере, выполнение происходит один раз. В этом режиме на клиенте нет никакой индикации прогресса выполнения. Обход результата запроса необходимо организовать самостоятельно. </font><span style="FONT-SIZE: large">В коде можно использовать <i>Сообщить</i>, но сообщения можно будет увидеть только после завершения выполнения. </span><span style="FONT-SIZE: large">Можно рекомендовать такой вариант, если алгоритм выполняется не долго.</span></p>
<p><span style="FONT-SIZE: large">Переменные, доступные в коде:</span></p>
<blockquote style="BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: medium none; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; BORDER-LEFT: medium none; MARGIN: 0px 0px 0px 40px; PADDING-RIGHT: 0px">
<p><b>Выборка</b><span style="FONT-SIZE: large"> - выборка из результата запроса.</span></p></blockquote>
<dt><font size="4">Пример.</font> 
<dt><font face="Courier New"><font color="#ff0000">Пока</font> <font color="#0000ff">Выборка</font><font color="#ff0000">.</font><font color="#0000ff">Следующий</font><font color="#ff0000">()</font> <font color="#ff0000">Цикл</font></font> 
<dt><font face="Courier New">    <font color="#0000ff">Выборка</font><font color="#ff0000">.</font><font color="#0000ff">Ссылка</font><font color="#ff0000">.</font><font color="#0000ff">ПолучитьОбъект</font><font color="#ff0000">().</font><font color="#0000ff">Удалить</font><font color="#ff0000">();</font></font> 
<dt><font color="#ff0000" face="Courier New">КонецЦикла;</font> 
<dt><span style="FONT-SIZE: large"><br></span>
<h2>Построчно без индикации</h2>
<p><font size="4">В этом режиме код вызывается для каждой строки. Нет необходимости организовывать обход результата запроса. </font><span style="FONT-SIZE: large">Так же можно использовать <i>Сообщить</i>, сообщения можно будет увидеть только после завершения выполнения.</span></p>
<p><span style="FONT-SIZE: large">Переменные, доступные в коде:</span></p>
<blockquote style="BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: medium none; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; BORDER-LEFT: medium none; MARGIN: 0px 0px 0px 40px; PADDING-RIGHT: 0px"></blockquote>
<blockquote style="BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: medium none; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; BORDER-LEFT: medium none; MARGIN: 0px 0px 0px 40px; PADDING-RIGHT: 0px">
<p><font size="4"><b>Выборка</b> - выборка из результата запроса, в которой уже выбрана строка.</font></p></blockquote>
<dt><font size="4">Пример.</font> 
<dt><font face="Courier New">    <span style="COLOR: rgb(0,0,255)">Выборка</span><font color="#ff0000">.</font><span style="COLOR: rgb(0,0,255)">Ссылка</span><font color="#ff0000">.</font><span style="COLOR: rgb(0,0,255)">ПолучитьОбъект</span><font color="#ff0000">().</font><span style="COLOR: rgb(0,0,255)">Удалить</span><font color="#ff0000">();</font></font> 
<dt><br><h2>Построчно с индикацией</h2>
<dt>
<p><font size="4">В отличие от "Построчно без индикации", на клиенте виден прогресс выполнения, прошедшее время выполнения, прогноз на оставшееся время. Возможно прерывание выполнения с помощью Ctrl+Break. Можно использовать <i>Сообщить</i>, но сообщения можно будет увидеть только по завершению выполнения. Код алгоритма пишется точно так же, что и в варианте "Построчно без индикации". Это самый удобный вариант, если нет БСП 2.3 и подходит построчный вариант обхода.</font></p>
<h2>Простое в фоне (БСП 2.3)</h2>
<div><font size="4">Для использования этого варианта в конфигурации должна быть БСП с версией не ниже 2.3. Код выполняется в фоновом задании, целиком. Обход результата запроса нужно организовывать самостоятельно. На клиенте отображается только время выполнения. Поскольку выполнение происходит в фоне, на клиенте можно продолжать работу. В этом режиме так же можно прерывать выполнение с помощью нажатия кнопки "Прервать" (Ctrl+F5). И еще одно преимущество - можно использовать <i>Сообщить</i>, и сообщения видны на клиенте с периодом обновления отображения состояния. Период обновления отображения по умолчанию одна секунда, можно изменить в "Опциях".</font></div>
<p><font size="4">Переменные, доступные в коде:</font></p>
<div>
<blockquote style="BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: medium none; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; BORDER-LEFT: medium none; MARGIN: 0px 0px 0px 40px; PADDING-RIGHT: 0px">
<p><font size="4"><b>Выборка</b> - выборка из результата запроса.</font></p>
<p><font size="4"><b>ПризнакПрогресса</b> - переменная для передачи в <i>СообщитьПрогресс</i> (см. ниже). </font></p></blockquote>
<p><font size="4">Пример.</font></p></div>
<dt><font color="#ff0000" face="Courier New">Пока</font><font color="#0000ff" face="Courier New"> Выборка</font><font color="#ff0000" face="Courier New">.</font><font color="#0000ff" face="Courier New">Следующий</font><font color="#ff0000" face="Courier New">()</font><font color="#0000ff" face="Courier New"> </font><font color="#ff0000" face="Courier New">Цикл</font> 
<dt><font style="caret-color: rgb(255, 0, 0)" color="#ff0000" face="Courier New">    </font><font color="#0000ff" face="Courier New">Объект </font><font color="#ff0000" face="Courier New">=</font><font color="#0000ff" face="Courier New"> Выборка</font><font color="#ff0000" face="Courier New">.</font><font color="#0000ff" face="Courier New">Ссылка</font><font color="#ff0000" face="Courier New">.</font><font color="#0000ff" face="Courier New">ПолучитьОбъект</font><font color="#ff0000" face="Courier New">();</font> 
<dt><font style="caret-color: rgb(255, 0, 0)" color="#ff0000" face="Courier New">    </font><font color="#0000ff" face="Courier New">Сообщить</font><font color="#ff0000" face="Courier New">(</font><font color="#0000ff" face="Courier New">Объект</font><font color="#ff0000" face="Courier New">);</font> 
<dt><font style="caret-color: rgb(255, 0, 0)" color="#ff0000" face="Courier New">    </font><font color="#0000ff" face="Courier New">Объект</font><font color="#ff0000" face="Courier New">.</font><font color="#0000ff" face="Courier New">Удалить</font><font color="#ff0000" face="Courier New">();</font> 
<dt>
<div></div>
<dt><font color="#ff0000"><font face="Courier New">КонецЦикла</font><font face="Courier New">;</font></font> 
<dt><font size="4"><br></font>
<dt><font size="4">Кроме этого, вариант "</font><span style="FONT-SIZE: large">Простое в фоне (БСП 2.3)" позволяет отображать и прогресс, если использовать функцию </span><font size="4"><i>СообщитьПрогрес</i></font><span style="FONT-SIZE: large">:</span> 
<dt><font color="#008200" face="Courier New">//Этот метод можно использовать в коде для отображения прогресса.</font> 
<dt><font color="#008200" face="Courier New">//Параметры:</font> 
<dt><font color="#008200" face="Courier New">//<span class="Apple-tab-span" style="WHITE-SPACE: pre"> </span>Обработано - число, количество обработанных записей.</font> 
<dt><font color="#008200" face="Courier New">//<span class="Apple-tab-span" style="WHITE-SPACE: pre"> </span>КоличествоВсего - число, количество записей в выборке всего.</font> 
<dt><font color="#008200" face="Courier New">//<span class="Apple-tab-span" style="WHITE-SPACE: pre"> </span>ВремяНачалаВМиллисекундах - число, дата начала обработки, полученное с помощью ТекущаяУниверсальнаяДатаВМиллисекундах()</font> 
<dt><font color="#008200" face="Courier New">//<span class="Apple-tab-span" style="WHITE-SPACE: pre"> </span>в момент начала обработки. Это значение необходимо корректного расчета оставшегося времени.</font> 
<dt><font color="#008200" face="Courier New">//<span class="Apple-tab-span" style="WHITE-SPACE: pre"> </span>ПризнакПрогресса - строка, специальное значение, необходимое для передачи значений прогресса на клиент.</font> 
<dt><font color="#008200" face="Courier New">//<span class="Apple-tab-span" style="WHITE-SPACE: pre"> </span>Это значение необходимо просто передать в параметр без изменений.</font> 
<dt><font color="#0000ff" face="Courier New">СообщитьПрогресс</font><font color="#ff0000" face="Courier New">(</font><font color="#0000ff" face="Courier New">Обработано</font><font color="#ff0000" face="Courier New">,</font><font color="#0000ff" face="Courier New"> КоличествоВсего</font><font color="#ff0000" face="Courier New">,</font><font color="#0000ff" face="Courier New"> ВремяНачалаВМиллисекундах</font><font color="#ff0000" face="Courier New">,</font><font color="#0000ff" face="Courier New"> ПризнакПрогресса</font><font color="#ff0000" face="Courier New">)</font> 
<dt><br><div><font size="4">Пример с отображением прогресса.</font></div>
<div><font face="Courier New">
<div><font color="#0000ff">й </font><font color="#ff0000">=</font><font color="#0000ff"> </font>0<font color="#ff0000">;</font></div>
<div><span style="COLOR: rgb(0,0,255)">КоличествоВсего </span><font color="#ff0000">=</font><font color="#0000ff"> Выборка.Количество</font><font color="#ff0000">();</font></div>
<div><span style="COLOR: rgb(0,0,255)">ВремяНачалаВМиллисекундах </span><font color="#ff0000">=</font><font color="#0000ff"> ТекущаяУниверсальнаяДатаВМиллисекундах</font><font color="#ff0000">();</font></div>
<div><font color="#ff0000">Пока</font><span style="COLOR: rgb(0,0,255)"> Выборка</span><font color="#ff0000">.</font><span style="COLOR: rgb(0,0,255)">Следующий</span><font color="#ff0000">() Цикл</font></div>
<div style="COLOR: rgb(0,0,255)"><span class="Apple-tab-span" style="WHITE-SPACE: pre"></span></div>
<div><span style="COLOR: rgb(0,0,255)">    Объект </span><font color="#ff0000">=</font><font color="#0000ff"> Выборка</font><font color="#ff0000">.</font><font color="#0000ff">Ссылка</font><font color="#ff0000">.</font><font color="#0000ff">ПолучитьОбъект</font><font color="#ff0000">();</font></div>
<div><span style="COLOR: rgb(0,0,255)">    Объект</span><font color="#ff0000">.</font><span style="COLOR: rgb(0,0,255)">Удалить</span><font color="#ff0000">();</font></div></font></div>
<dt>
<div></div><font face="Courier New">
<div style="COLOR: rgb(0,0,255)"><span class="Apple-tab-span" style="WHITE-SPACE: pre"></span></div>
<div><font color="#0000ff">    й </font><font color="#ff0000">=</font><font color="#0000ff"> й </font><font color="#ff0000">+</font><font color="#0000ff"> </font>1<font color="#ff0000">;</font></div>
<div><font color="#008200">    //Передаём прогресс один раз на 10 записей, что бы меньше тормозить основную обработку.</font></div></font>
<div></div>
<dt>
<div><font color="#0000ff" face="Courier New">    </font><font color="#ff0000" face="Courier New">Если</font><font color="#0000ff" face="Courier New"> й </font><font color="#ff0000" face="Courier New">%</font><font color="#0000ff" face="Courier New"> </font><font face="Courier New">10</font><font color="#0000ff" face="Courier New"> </font><font color="#ff0000" face="Courier New">=</font><font color="#0000ff" face="Courier New"> </font><font face="Courier New">0</font><font color="#0000ff" face="Courier New"> </font><font color="#ff0000" face="Courier New">Тогда</font></div>
<div><font color="#0000ff" face="Courier New">        СообщитьПрогресс</font><font color="#ff0000" face="Courier New">(</font><font color="#0000ff" face="Courier New">й</font><font color="#ff0000" face="Courier New">,</font><font color="#0000ff" face="Courier New"> КоличествоВсего</font><font color="#ff0000" face="Courier New">,</font><font color="#0000ff" face="Courier New"> ВремяНачалаВМиллисекундах</font><font color="#ff0000" face="Courier New">,</font><font color="#0000ff" face="Courier New"> ПризнакПрогресса</font><font color="#ff0000" face="Courier New">);</font></div>
<div><font color="#0000ff" face="Courier New">    </font><font color="#ff0000"><font face="Courier New">КонецЕсли</font><font face="Courier New">;</font></font></div>
<div><span class="Apple-tab-span" style="WHITE-SPACE: pre"><font color="#0000ff" face="Courier New"></font></span></div>
<div><font color="#ff0000" face="Courier New">КонецЦикла;</font></div>
<div><br></div>
<div style="FONT-SIZE: large">
<h2>Построчно в фоне с индикацией (БСП 2.3)</h2></div>
<div style="FONT-SIZE: large">Для использования этого варианта в конфигурации должна быть БСП с версией не ниже 2.3. Работает точно так же, как "Построчно с индикацией", но выполнение происходит в фоне. Код вызывается для каждой записи. Прогресс обновляется с периодом, указанном в опциях (по умолчанию одна секунда). Можно использовать <i>Сообщить</i>, сообщения отображаются на клиенте с обновлением прогресса. В момент выполнения обработки на клиенте можно продолжать работу. Так же, как и в предыдущем варианте возможно прерывание. Это самый удобный вариант, если есть БСП 2.3 и подходит построчный вариант обхода.</div>
<dt><i><br></i>
<dt><font size="4">Пример.</font> 
<div><font face="Courier New"><font size="+0"><font color="#0000ff">Объект </font><font color="#ff0000">=</font><font color="#0000ff"> </font></font><font color="#0000ff">Выборка</font><font color="#ff0000">.</font><font color="#0000ff">Ссылка</font><font color="#ff0000">.</font><font color="#0000ff">ПолучитьОбъект</font><font color="#ff0000">();</font></font></div>
<div><font color="#0000ff" face="Courier New">Сообщить</font><font color="#ff0000" face="Courier New">(</font><font color="#0000ff" face="Courier New">Объект</font><font color="#ff0000" face="Courier New">);</font></div>
<div><font color="#0000ff" face="Courier New">Объект</font><font color="#ff0000" face="Courier New">.</font><font color="#0000ff" face="Courier New">Удалить</font><font color="#ff0000" face="Courier New">();</font></div>
<div>
<blockquote style="BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: medium none; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; BORDER-LEFT: medium none; MARGIN: 0px 0px 0px 40px; PADDING-RIGHT: 0px">
<div><br></div></blockquote></div>
<dt style="FONT-SIZE: large">
<div></div>
<div></div></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></dt></body></html>